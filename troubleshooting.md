# トラブルシューティング

ここ参考にすると良いと思います  
　[動かなくて相談したいときに事前に確認する項目](https://scrapbox.io/self-made-kbds-ja/%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%8F%E3%81%A6%E7%9B%B8%E8%AB%87%E3%81%97%E3%81%9F%E3%81%84%E3%81%A8%E3%81%8D%E3%81%AB%E4%BA%8B%E5%89%8D%E3%81%AB%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B%E9%A0%85%E7%9B%AE)

## 必要な道具

- テスター
- ピンセット

　導通テストが出来るテスターなら導通モードに、なければ抵抗値を測るモードにしてレンジは0Ωかどうかの見分けがしやすいモードにしてください。  

## 注意事項

　テスターを端子にあてて計測するさい、計測対象は電源が入っていない状態で行ってください。  

## 各項目共通の確認事項

- pro microに適切なファームウェアを書き込んでいるか
- pro microはしっかり差し込まれているか
- ハンダを適切に付けられているか
- パーツの極性（取り付ける向き）は間違っていないか

　また左右のキーボードを接続する場合は両方のpro microに同じファームウェアが入っている必要があります。  

### はんだ付けについて

[はんだ付け基礎講座　WEB版](https://noseseiki.com/kisokouza/01.html)  
[電子工作のコツ/はんだ付け](https://www.murata.com/ja-jp/campaign/ads/japan/elekids/ele/craft/knack/soldering)  

をはじめとして探せば適切なはんだ付けについて書かれていますので一読をおすすめします。  

　ハンダごての設定温度が高く、かつ長時間あてつづけるとTRRSジャックやコンスル―ピン、OLEDのピンやソケットのプラを溶かして接続不良の原因になります。また基板のシルクやレジストにも影響し基板の剥がれも起きやすくメリットがないので、🔰ほど温度調節機能付きハンダごてをオススメします。  

## キースイッチ

### まったく動作しない

　pro microの取り付け向きを確認してください。pro microはICの実装されていない面が下側です。  
　pro microの取り付け位置は、基板の白い枠にpro microのピンを合わせて取り付けてください。  
　pro microが浮いていないことを確認してください。  
　ダイオードの極性が間違っていないか確認してください。  

### 一部のキーが動かない

　MX Socketのハンダ不良、はんだ忘れか、スイッチの端子がソケットに正しく入っていない可能性があります。  

### 行単位、列単位で動作しない、押したキーとは違うキーが反応する

　pro microとピンのはんだ付けミスの可能性が高いです。よく確認して隣のピンとショートしていないことを確認して、ハンダごてを当てなおして各ピンに付けたハンダを温めなおしてみてください。  

## LED

### まったく点灯しない

　書き込んだキーマップのrules.mkのLED_BACK_ENABLEが = yesか確認してください。  
　初期状態はLEDがOFFなのでONにしてください。  
Lower + Raise + AキーでON/OFFを切り替えられます。  
　[キーマップ](https://github.com/marksard/qmk_firmware/blob/my_customize/keyboards/rhymestone/keymaps/default/readme_jp.md)  

　切り替えても点灯しない場合は先頭のLEDのDIN、GND、VCCがハンダ不良か、DINが熱で死んでいるかで起こり得ます。  
　ハンダ不良の可能性から疑ってハンダを温めなおしたりハンダを付け直してみてください。ダメならLEDチップを交換してください。  

### 途中からLEDが途切れる

　途切れたLEDのDIN、GND、VCCがハンダ不良か、DINが熱で死んでいるか、その一つ手前のDOUTががハンダ不良か、DINが熱で死んでいるかで起こり得ます。  
　ハンダ不良の可能性から疑ってハンダを温めなおしたりハンダを付け直してみてください。ダメならLEDチップを交換してください。  

### 一部のLEDだけ点灯しない

　LEDのDIN、DOUTが生きていて、GNDかVCCの端子が熱で死んでいるかハンダ不良の場合に起こり得ます。  
　ハンダ不良の可能性から疑ってハンダを温めなおしたりハンダを付け直してみてください。ダメならLEDチップを交換してください。  

### 一部違う色になる、色を変更しても変化したりしなかったりする

　該当のLEDのDINの接触不良か、該当のLEDにつないでいるDOUTの接続不良かどちらかです。  
　ハンダを温めなおしたりハンダを付け直してみてください。  

## OLED

　書き込んだキーマップのrules.mkのOLED_ENABLEが = yesか確認してください。  
　スイッチなどはないので、電源が入れば点灯、表示されるようになっています。  

　表示されない場合はOLEDとピンのハンダ不良か、RhymestoneであればOLEDの取り付けソケットとpro microの間にあるハンダブリッジ部分のハンダ不良の可能性があります。  

## キーボード同士の接続

　TRSケーブル、TRRSケーブルで左右を接続し、USBを左手側に接続した状態で、左側だけ認識して右側は反応しない、逆にUSBを右手側に繋ぐと左手側が反応しないときは、左右の接続に問題があります。  

### 電源ラインの確認

　USBを接続した側の電源をもう一方へ供給しています。USBを接続していないほうのpro microに仕込まれたLEDか、バックライトLED、OLEDの表示を確認してください。点灯していないならケーブル不良、もしくはジャックの接続不良が考えられます。  
　TRRSジャックのハンダを温めなおしたりハンダを付け直してみてください。  

### TRSケーブル、TRRSケーブル

　Rhymestone、Treadstone48はTRSケーブル、TRRSケーブルどちらでの接続でも問題なく動作することを確認しています。  
　ケーブルの導通が正しいかテスターで確認してください。両端のT,R,R,Sをそれぞれが独立して導通していることを確認してください。  

### TRRSジャックとケーブルを付けての確認

　TRRSジャックからpro microへの経路が正しいか確認します。  
　左右をケーブルで接続した状態で、両側のTRRSジャックにテスターをあてて導通しているかチェックしてください。導通しているのが確認が取れたら両側のpro microのVCC同士、GND同士、RX同士の導通確認をしてください。導通していない場合はpro microとTRRSジャックの経路があやしい（基板不良）か、TRRSジャックの接続不良、TRRSジャック自体が壊れていることも考えられます。  

### シリアル通信速度を変更する

　ここまでの検査で導通に問題なければ、なんらかの影響で信号ラインにノイズが乗っていて左右の通信がうまく出来ていない可能性があります。  

ファームウェアのキーボードフォルダのRhymestone/Treadstone48の直下にserial.cファイルがあります。この中のこの部分を見つけてください

```c
#define SELECT_SOFT_SERIAL_SPEED 1
//  0: about 189kbps
//  1: about 137kbps (default)
//  2: about 75kbps
//  3: about 39kbps
//  4: about 26kbps
//  5: about 20kbps
```

この  

```#define SELECT_SOFT_SERIAL_SPEED 1```  

を  

```#define SELECT_SOFT_SERIAL_SPEED 5```

に変更して両方のpro microに書き込み、左手、右手が動作するか確認してください。動作するのであれば5を4,3,2と速めて動かなくなる一つ手前をご使用ください。  

### ここまででまだ左右の接続がうまくいかない…

- TRRSケーブル/TRSケーブルの検査
- 両方のTRRSジャックの検査
- TRRSジャックからpro microまで経路検査

で接続自体は正常な事を確認出来ているので基板自体は正常なはずです。また、  

- シリアル通信速度の変更

で通信速度を落として接続が出来るかどうかも確認しています。  

TRRSケーブル/TRSケーブルを変えてみると正常動作するという報告もありますので、一度ご検討をお願いいたします。  

### I2C通信に変更する

　Rhymestone/Treadstone48ともにI2Cでの接続は未検証かつ少し基板のジャンパパッドのカット、ハンダでジャンパする、ひょっとすると抵抗が必要、みたいな改造が必要になります。ご用命があれば検証いたします。  
